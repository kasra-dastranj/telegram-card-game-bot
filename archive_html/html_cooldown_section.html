<!-- Ø¨Ø®Ø´ Ù…Ø¯ÛŒØ±ÛŒØª Cooldown Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ -->
<!-- Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ card_management.html Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆØ¯ -->

<script type="text/babel">
// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† state Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ù‡ Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª App:

const [cooldownSettings, setCooldownSettings] = useState({});
const [showCooldownPanel, setShowCooldownPanel] = useState(false);
const [cooldownLoading, setCooldownLoading] = useState(false);

// ØªÙˆØ§Ø¨Ø¹ Ù…Ø¯ÛŒØ±ÛŒØª Cooldown:

const fetchCooldownSettings = async () => {
    try {
        setCooldownLoading(true);
        const response = await fetch('/api/cards/cooldown-settings');
        const data = await response.json();
        
        if (data.success) {
            setCooldownSettings(data.cards);
        } else {
            throw new Error(data.error || 'Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª ØªÙ†Ø¸ÛŒÙ…Ø§Øª cooldown');
        }
    } catch (err) {
        console.error('Error fetching cooldown settings:', err);
        alert('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª ØªÙ†Ø¸ÛŒÙ…Ø§Øª cooldown: ' + err.message);
    } finally {
        setCooldownLoading(false);
    }
};

const updateCardCooldown = async (cardId, settings) => {
    try {
        const response = await fetch(`/api/cards/${cardId}/cooldown`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(settings)
        });
        
        const data = await response.json();
        
        if (data.success) {
            alert(data.message);
            fetchCooldownSettings(); // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù„ÛŒØ³Øª
        } else {
            throw new Error(data.error || 'Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ');
        }
    } catch (err) {
        console.error('Error updating cooldown:', err);
        alert('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: ' + err.message);
    }
};

const resetAllCooldowns = async () => {
    if (!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ù‡Ù…Ù‡ cooldown Ù‡Ø§ÛŒ ÙØ¹Ø§Ù„ Ø±Ø§ Ø±ÛŒØ³Øª Ú©Ù†ÛŒØ¯ØŸ')) {
        return;
    }
    
    try {
        const response = await fetch('/api/cards/cooldown-settings/reset', {
            method: 'POST'
        });
        
        const data = await response.json();
        
        if (data.success) {
            alert(data.message);
            fetchCooldownSettings();
        } else {
            throw new Error(data.error || 'Ø®Ø·Ø§ Ø¯Ø± Ø±ÛŒØ³Øª');
        }
    } catch (err) {
        console.error('Error resetting cooldowns:', err);
        alert('Ø®Ø·Ø§ Ø¯Ø± Ø±ÛŒØ³Øª: ' + err.message);
    }
};

// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† useEffect Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡:
useEffect(() => {
    fetchCards();
    fetchStats();
    fetchCooldownSettings(); // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§ÛŒÙ† Ø®Ø·
}, []);

// Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ù¾Ù†Ù„ Cooldown:
const CooldownPanel = () => (
    <div className="bg-white shadow rounded-lg p-6 mb-8">
        <div className="flex justify-between items-center mb-6">
            <h2 className="text-xl font-semibold">â„ï¸ Ù…Ø¯ÛŒØ±ÛŒØª Cooldown Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§</h2>
            <div className="flex gap-2">
                <button
                    onClick={fetchCooldownSettings}
                    className="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
                    disabled={cooldownLoading}
                >
                    {cooldownLoading ? 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ...' : 'ğŸ”„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ'}
                </button>
                <button
                    onClick={resetAllCooldowns}
                    className="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"
                >
                    ğŸ—‘ï¸ Ø±ÛŒØ³Øª Ù‡Ù…Ù‡
                </button>
            </div>
        </div>
        
        {cooldownLoading ? (
            <p className="text-center py-4">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª...</p>
        ) : Object.keys(cooldownSettings).length === 0 ? (
            <p className="text-center py-4">Ù‡ÛŒÚ† Ú©Ø§Ø±Øª Epic/Legend ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>
        ) : (
            <div className="overflow-x-auto">
                <table className="min-w-full bg-white">
                    <thead>
                        <tr className="bg-gray-100">
                            <th className="py-2 px-4 border-b text-right">Ú©Ø§Ø±Øª</th>
                            <th className="py-2 px-4 border-b text-right">Ú©Ù…ÛŒØ§Ø¨ÛŒ</th>
                            <th className="py-2 px-4 border-b text-right">Ø­Ø¯ Ù…Ø¬Ø§Ø² Ø¨Ø±Ø¯</th>
                            <th className="py-2 px-4 border-b text-right">Ù…Ø¯Øª Cooldown (Ø³Ø§Ø¹Øª)</th>
                            <th className="py-2 px-4 border-b text-right">ÙˆØ¶Ø¹ÛŒØª</th>
                            <th className="py-2 px-4 border-b text-right">Ø¹Ù…Ù„ÛŒØ§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        {Object.entries(cooldownSettings).map(([cardId, settings]) => (
                            <CooldownRow 
                                key={cardId} 
                                cardId={cardId} 
                                settings={settings}
                                onUpdate={updateCardCooldown}
                            />
                        ))}
                    </tbody>
                </table>
            </div>
        )}
    </div>
);

// Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ø±Ø¯ÛŒÙ Cooldown:
const CooldownRow = ({ cardId, settings, onUpdate }) => {
    const [editing, setEditing] = useState(false);
    const [formData, setFormData] = useState({
        win_limit: settings.win_limit,
        cooldown_hours: settings.cooldown_hours,
        enabled: settings.enabled
    });
    
    const handleSave = async () => {
        await onUpdate(cardId, formData);
        setEditing(false);
    };
    
    const handleCancel = () => {
        setFormData({
            win_limit: settings.win_limit,
            cooldown_hours: settings.cooldown_hours,
            enabled: settings.enabled
        });
        setEditing(false);
    };
    
    const getRarityColor = (rarity) => {
        switch(rarity) {
            case 'epic': return 'bg-purple-100 text-purple-800';
            case 'legend': return 'bg-yellow-100 text-yellow-800';
            default: return 'bg-gray-100 text-gray-800';
        }
    };
    
    return (
        <tr className="hover:bg-gray-50">
            <td className="py-2 px-4 border-b font-medium">{settings.name}</td>
            <td className="py-2 px-4 border-b">
                <span className={`px-2 py-1 rounded text-xs ${getRarityColor(settings.rarity)}`}>
                    {settings.rarity === 'epic' ? 'ğŸŸ£ Epic' : 'ğŸŸ¡ Legend'}
                </span>
            </td>
            <td className="py-2 px-4 border-b">
                {editing ? (
                    <input
                        type="number"
                        min="1"
                        max="100"
                        value={formData.win_limit}
                        onChange={(e) => setFormData({...formData, win_limit: parseInt(e.target.value)})}
                        className="w-20 p-1 border rounded text-center"
                    />
                ) : (
                    settings.win_limit
                )}
            </td>
            <td className="py-2 px-4 border-b">
                {editing ? (
                    <input
                        type="number"
                        min="1"
                        max="168"
                        value={formData.cooldown_hours}
                        onChange={(e) => setFormData({...formData, cooldown_hours: parseInt(e.target.value)})}
                        className="w-20 p-1 border rounded text-center"
                    />
                ) : (
                    settings.cooldown_hours
                )}
            </td>
            <td className="py-2 px-4 border-b">
                {editing ? (
                    <label className="flex items-center">
                        <input
                            type="checkbox"
                            checked={formData.enabled}
                            onChange={(e) => setFormData({...formData, enabled: e.target.checked})}
                            className="mr-2"
                        />
                        <span>{formData.enabled ? 'âœ… ÙØ¹Ø§Ù„' : 'âŒ ØºÛŒØ±ÙØ¹Ø§Ù„'}</span>
                    </label>
                ) : (
                    <span className={settings.enabled ? 'text-green-600' : 'text-red-600'}>
                        {settings.enabled ? 'âœ… ÙØ¹Ø§Ù„' : 'âŒ ØºÛŒØ±ÙØ¹Ø§Ù„'}
                    </span>
                )}
            </td>
            <td className="py-2 px-4 border-b">
                {editing ? (
                    <div className="flex gap-1">
                        <button
                            onClick={handleSave}
                            className="bg-green-500 hover:bg-green-700 text-white font-bold py-1 px-2 rounded text-xs"
                        >
                            âœ… Ø°Ø®ÛŒØ±Ù‡
                        </button>
                        <button
                            onClick={handleCancel}
                            className="bg-gray-500 hover:bg-gray-700 text-white font-bold py-1 px-2 rounded text-xs"
                        >
                            âŒ Ù„ØºÙˆ
                        </button>
                    </div>
                ) : (
                    <button
                        onClick={() => setEditing(true)}
                        className="bg-blue-500 hover:bg-blue-700 text-white font-bold py-1 px-2 rounded text-xs"
                    >
                        âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´
                    </button>
                )}
            </td>
        </tr>
    );
};

// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Cooldown Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ:
// Ø¯Ø± Ø¨Ø®Ø´ headerØŒ Ø¨Ø¹Ø¯ Ø§Ø² Ø¯Ú©Ù…Ù‡ "Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Øª Ø¬Ø¯ÛŒØ¯":

<button
    onClick={() => setShowCooldownPanel(!showCooldownPanel)}
    className={`font-bold py-2 px-4 rounded ml-2 ${
        showCooldownPanel 
            ? 'bg-purple-500 hover:bg-purple-700 text-white' 
            : 'bg-gray-200 hover:bg-gray-300 text-gray-800'
    }`}
>
    â„ï¸ Ù…Ø¯ÛŒØ±ÛŒØª Cooldown
</button>

// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„ Cooldown Ø¨Ù‡ render:
// Ø¨Ø¹Ø¯ Ø§Ø² Ø¨Ø®Ø´ Ø¢Ù…Ø§Ø± Ùˆ Ù‚Ø¨Ù„ Ø§Ø² ÙØ±Ù…:

{showCooldownPanel && <CooldownPanel />}

</script>

<!-- Ù†Ú©Ø§Øª Ù…Ù‡Ù… Ø¨Ø±Ø§ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù†:
1. state Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ø¨Ù‡ useState Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
2. ØªÙˆØ§Ø¨Ø¹ Ù…Ø¯ÛŒØ±ÛŒØª Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯  
3. useEffect Ø±Ø§ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ù†ÛŒØ¯
4. Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
5. Ø¯Ú©Ù…Ù‡ Ùˆ Ù¾Ù†Ù„ Ø±Ø§ Ø¨Ù‡ render Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
-->